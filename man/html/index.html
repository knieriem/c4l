<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>can4linx - CAN network device driver</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>can4linx - CAN network device driver</h1>
<p>
 The LINUX CAN driver can be used to control the CAN bus connected with the AT-CAN-MINI PC interface card. This project was done in cooperation with the LINUX LLP Project to control laboratory or automation devices via CAN.
<p>
The full featured can4linux supports many different interface boards. It is possible to use different kinds of boards at the same time. Up to four boards can be placed in one computer. With this feature it is possible to use /dev/can0 and /dev/can2 for two boards AT-CAN-MINI with SJA1000 and /dev/can1 and /dev/can3 with two CPC-XT equipped with Intel 82527. In all these configurations the programmer sees the same driver interface with open(), close(), read(), write() and ioctl() calls ( <a class="el" href="can__open_8c.html#a1">can_open</a>(), <a class="el" href="can__close_8c.html#a1">can_close</a>(), <a class="el" href="can__read_8c.html#a0">can_read</a>(), <a class="el" href="can__write_8c.html#a0">can_write</a>(), <a class="el" href="can__ioctl_8c.html#a5">can_ioctl</a>() ).
<p>
The driver itself is highly configurable using the /proc interface of the LINUX kernel.
<p>
The following listing shows a typical configuration with three boards:
<p>
<div class="fragment"><pre>$ grep . /proc/sys/Can/\*
/proc/sys/Can/AccCode:  -1       -1      -1      -1
/proc/sys/Can/AccMask:  -1       -1      -1      -1
/proc/sys/Can/Base:     800      672     832     896
/proc/sys/Can/Baud:     125      125     125     250
/proc/sys/Can/Chipset:  82c200   82c200  82c200  none
/proc/sys/Can/IOModel:  pppp
/proc/sys/Can/IRQ:      5     7       3       5
/proc/sys/Can/Outc:     250   250     250     0
/proc/sys/Can/Overrun:  0     0       0       0
/proc/sys/Can/RxErr:    0     0       0       0
/proc/sys/Can/Timeout:  100   100     100     100
/proc/sys/Can/TxErr:    0     0       0       0
/proc/sys/Can/TxSpeed:  ffff
/proc/sys/Can/VendOpt:  nnnn
/proc/sys/Can/dbgMask:  0
/proc/sys/Can/version:  2.3
</pre></div>
<p>
This above mentioned full flexibility is not needed in embedded applications. For this applications, a stripped-down version exists. It uses the same programming interface but does the most configurations at compile time. That means especially that only one CAN controller support with a special register access method is compiled into the driver. Actually the only CAN controller supported by this version is the Philips SJA 1000 in both the compatibility mode  <b>BasicCAN</b> and the Philips \PeliCAN mode (compile time selectable).
<p>
The following sections are describing the <em>sysctl</em> entries.<dl compact><dt><b>AccCode/AccMask</b></dt><dd>
contents of the message acceptance mask and acceptance code registers of 82x200/SJA1000 compatible CAN controllers (see <a class="el" href="can__ioctl_8c.html#a5">can_ioctl</a>()). </dl><dl compact><dt><b>Base</b></dt><dd>
CAN controllers base address for each board. Depending of the <em>IOModel</em> entry that can be a memory or I/O address. (read-only for PCI boards) </dl><dl compact><dt><b>Baud</b></dt><dd>
used bit rate for this board </dl><dl compact><dt><b>Chipset</b></dt><dd>
name of the used CAN chip for this board. Read only for this version. </dl><dl compact><dt><b>IOModel</b></dt><dd>
one letter for each port. Set the CAN register access model. The following models are currently supported: <ul>
<li> m - memory access, the registers are directly mapped into memory <li> f - fast register access, special mode for the 82527 uses memory locations for register addresses  (ELIMA) <li> p - port I/O, 80x86 specific I/O address range (AT-CAN-MINI) <li> b - special mode for the B&amp;R CAN card, two special I/O addresses for register addressing and access Since version 2.4 set at compile time. </ul>
</dl><dl compact><dt><b>IRQ</b></dt><dd>
used IRQ numbers, one value for each board. (read-only for PCI boards) </dl><dl compact><dt><b>Outc</b></dt><dd>
value of the output control register of the CAN controller Since version 2.4 set at compile time. </dl><dl compact><dt><b>Overrun</b></dt><dd>
counter for overrun conditions in the CAN controller </dl><dl compact><dt><b>RxErr</b></dt><dd>
counter for CAN controller rx error conditions </dl><dl compact><dt><b>Timeout</b></dt><dd>
time out value for waiting for a successful transmission </dl><dl compact><dt><b>TxErr</b></dt><dd>
counter for CAN controller tx error conditions </dl><dl compact><dt><b>TxSpeed</b></dt><dd>
flag for <b>f</b> fast (use tx interrupts) or <b>s</b> slow  </dl><dl compact><dt><b>VendOpt</b></dt><dd>
vendor specific flag for each board.  Two vendor specific ports are now supported 's' for the STZP(IXXAT) PC I-03 'a' for the Advantech Pcm-3680 board </dl><dl compact><dt><b>dbgMask</b></dt><dd>
if compiled with debugging support, writing a value greater then 0  enables debugging to <b>syslogd</b> </dl><dl compact><dt><b>version</b></dt><dd>
read only entry containing the drivers version number</dl>Please see also at <a class="el" href="can__ioctl_8c.html#a5">can_ioctl</a>() for some additional descriptions.
<p>
For initially writing these sysctl entries after loading the driver (or at any time) a shell script utility does exist. It uses a board configuration file that is written over <em>/proc/sys/Can</em> . <div class="fragment"><pre>utils/cansetup port.conf
</pre></div> or, like used in the Makefile: <div class="fragment"><pre>CONFIG := $(shell uname -n)

<span class="preprocessor"># load host specific CAN configuration</span>
<span class="preprocessor"></span>load:
        @echo <span class="stringliteral">"Loading etc/$(CONFIG).conf CAN configuration"</span>
        utils/cansetup etc/$(CONFIG).conf
        echo 0 &gt;/proc/sys/Can/dbgMask
</pre></div> Example *.conf files are located in the <em>etc/</em> directory.
<p>
<dl compact><dt><b>Note: </b></dt><dd>
This documentation was created using the wonderful tool <b>Doxygen</b> <a href="http://www.doxygen.org/index.html">http://www.doxygen.org/index.html</a> . Die Dokumentation wurde unter Verwendung von <b>Doxygen</b> <a href="http://www.doxygen.org/index.html">http://www.doxygen.org/index.html</a> erstellt</dl>
<hr>
<address><small>
Generated at
Son Dez  1 18:02:53 CET 2002
CAN driver can4linux
by
<a href="http://www.port.de">
<img src="port.gif" alt="port GmbH" align="middle" border=0 
width=110 height=53></a>
<a href="mailto:service@port.de"> service@port.de </a>,
 &copy;&nbsp;1997-2001
</small></address>
